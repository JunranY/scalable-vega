var e=require("vega"),r=require("querystring");function t(r){e.Transform.call(this,[],r)}require("http"),t.type=function(e){return"Serverless"==e?(this._type=e,this):(this._type="Server",this._type)},t.setHttpOptions=function(e){return e?(this._httpOptions=e,this):this._httpOptions},t.QueryFunction=function(e){return e?(this._QueryFunction=e,this):this._QueryFunction},t.Definition={type:"dbtransform",metadata:{changes:!0,source:!0},params:[{name:"query",type:"string",required:!0}]},e.inherits(t,e.Transform).transform=function(n,o){try{var i,s=this,u=function(r){i.forEach(e.ingest);var t=o.fork(o.NO_FIELDS&o.NO_SOURCE);return t.rem=s.value,s._argval.toArray&&(i=[i[0].min,i[0].max]),s.value=t.add=t.source=i,t};if(!t._httpOptions&&!t._QueryFunction)throw Error("Core session or http option is missing. Please assign it to the Vega transform");var a="Serverless"==t._type?(o.dataflow.info("DuckDB Core Query: "+n.query),Promise.resolve(t._QueryFunction(n.query)).then(function(e){i=e})):function(){if("Server"!=t._type)throw Error("Core type hasn't been assigned. Please assign it to the Vega transform");var e=function(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}(function(){return Promise.resolve(function(){try{var e=t._httpOptions;return Promise.resolve(fetch(e.url,{method:e.method,mode:e.mode,headers:e.headers,body:r.stringify({query:n.query})})).then(function(e){return e.ok?Promise.resolve(e.json()):Promise.resolve(e.json()).then(function(e){throw Error((e.error+": "+e.message).replace(/(\r\n|\n|\r)/gm,""))})})}catch(e){return Promise.reject(e)}}()).then(function(e){i=e})},function(e){console.log(e)});if(e&&e.then)return e.then(function(){})}();return Promise.resolve(a&&a.then?a.then(u):u())}catch(e){return Promise.reject(e)}},module.exports=t;
//# sourceMappingURL=vega-transform-db.js.map
